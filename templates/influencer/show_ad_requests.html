{% extends 'layout.html' %}

{% block title %}
    Show Ad Requests
{% endblock %}

{% block content %}
    <div class="p-4 bg-white bg-opacity-75 rounded shadow mt-3">
        <h1 class="display-1">Hello @<span class="text-muted">{{  influencer.username  }}</span></h1>
        <div class="d-flex gap-5">
            <button type="submit" class="btn btn-primary"><i class="fa-regular fa-eye"></i> Show Ad Requests</button>
            
            <a href="{{  url_for('search_campaigns', influencer_id = influencer.id)  }}" class="btn btn-secondary"><i class="fa-solid fa-magnifying-glass"></i> Search Campaigns</a>
        </div>
    </div>    

    <div class="p-4 bg-white bg-opacity-75 rounded shadow mt-3">
        <h1 class="display-1">My Ad requests</h1>
        <table class="table table-hover">
            <thead>
                <tr>
                    <td>Campaign</td>
                    <td>Sponsor</td>
                    <td>Message</td>
                    <td>Requirement</td>
                    <td>Payment</td>
                    <td>Status</td>
                    <td>Actions</td>
                </tr>
            </thead>
            <tbody>
                {% for ad_request in ad_requests %}
                    <tr>
                        <td>{{ad_request.campaign.name}}</td>
                        <td>{{ad_request.sponsor.name}}</td>
                        <td>{{ad_request.messages}}</td>
                        <td>{{ad_request.requirements}}</td>
                        <td>{{ad_request.payment_amount}}</td>
                        <td>
                            {% if (ad_request.sponsor_accepted == True) and (ad_request.influencer_accepted == None) %}
                                Sponsor Accepted
                            {% elif (ad_request.sponsor_accepted == None) and (ad_request.influencer_accepted == True) %}
                                Influencer Accepted
                            {% elif (ad_request.sponsor_accepted == False) and (ad_request.influencer_accepted == None) %}
                                Sponsor Rejected
                            {% elif (ad_request.sponsor_accepted == None) and (ad_request.influencer_accepted == False) %}
                                Influencer Rejected
                            {% else %}
                                {{ad_request.status}}
                            {% endif %}
                        </td>
                        <td>
                            {% if ad_request.sponsor_accepted == True and ad_request.influencer_accepted == True%}
                                {% if ad_request.payment_status == True %}
                                    <button class="btn btn-success"><i class="fa-solid fa-thumbs-up"></i> Payment Done </button>
                                {% else %}
                                <button class="btn btn-secondary" disabled><i class="fa-solid fa-money-bill"></i> Awaiting Payment </button>
                                {% endif %}
                            {% elif ad_request.influencer_accepted == True and ad_request.sponsor_accepted != False %}
                                <button class="btn btn-success" disabled><i class="fa-regular fa-circle-check"></i> Accepted </button>
                            {% elif (ad_request.influencer_accepted == False) or (ad_request.sponsor_accepted == False) %}
                                <button class="btn btn-danger" disabled><i class="fa-regular fa-circle-xmark"></i> Rejected </button>
                            {% else %}
                                <form action="{{url_for('influencer_accept_request', influencer_id=influencer.id, request_id = ad_request.id)}}" method="post">
                                    <button class="btn btn-success"><i class="fa-regular fa-circle-check"></i> Accept</button>
                                </form>
                                <form action="{{url_for('influencer_reject_request', influencer_id=influencer.id, request_id = ad_request.id)}}" method="post">
                                    <button class="btn btn-danger"><i class="fa-regular fa-circle-xmark"></i> Reject</button>
                                </form>
                                <form action="{{url_for('negotiate_ad_request_influencer', influencer_id=influencer.id, ad_request_id = ad_request.id)}}">
                                    <button class="btn btn-info"><i class="fa-regular fa-handshake"></i> Negotiate</button>
                                </form>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="form-group p-2"></div>
            <a href="{{ url_for('influencer_home') }}" class="btn btn-info"><i class="fa fa-arrow-circle-left"></i> Go Back</a>
        </div>
    </div>
{% endblock %}